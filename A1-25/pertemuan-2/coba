from prettytable import PrettyTable
import os

# Data pengguna disimpan di dictionary
pengguna = {
    "alia": {"password": "015", "akses": "admin"}
}

# Data alat berat dalam dictionary (nested dictionary)
alat_berat = {
    "Excavator": {"merek": "Hitachi", "tahun": 2010, "status": "Siap Pakai"},
    "Bulldozer": {"merek": "Caterpillar", "tahun": 2020, "status": "Rusak"},
    "Compactor": {"merek": "Bomag", "tahun": 2005, "status": "Dalam Perbaikan"}
}

akses = ""

while True:
    os.system("cls" if os.name == "nt" else "clear")
    print("=== AKSES PENGELOLA ALAT BERAT ===")
    print("1. Login")
    print("2. Register")
    print("3. Keluar")

    menu = input("Pilih menu (1-3): ")

    os.system("cls" if os.name == "nt" else "clear")
    
    # LOGIN
    if menu == "1":
        print("=== LOGIN ADMIN ===")
        username = input("Masukkan Username: ").strip()
        password = input("Masukkan Password: ").strip()

        if username in pengguna and pengguna[username]["password"] == password:
            akses = pengguna[username]["akses"]
            print(f"Login berhasil sebagai {akses}")
        else:
            print("Username atau password salah!")
            continue

        # MENU ADMIN
        while akses == "admin":
            print("\n=== MENU PENGELOLA ALAT BERAT ===")
            print("1. Create = Tambah alat berat baru")
            print("2. Read = Tampilkan alat berat")
            print("3. Update = Mengubah status alat berat")
            print("4. Delete = Menghapus alat berat")
            print("5. Keluar")

            pilihan = input("Pilih menu (1-5): ")

            # CREATE
            if pilihan == "1":
                os.system("cls" if os.name == "nt" else "clear")
                print("=== TAMBAH ALAT BARU ===")
                nama = input("Masukkan nama alat: ").strip()
                merek = input("Masukkan merek alat: ").strip()
                tahun = int(input("Masukkan tahun alat: "))
                status = input("Masukkan status alat (Siap Pakai/Rusak/Dalam Perbaikan): ").strip()

                alat_berat.update({
                    nama: {"merek": merek, "tahun": tahun, "status": status}
                })

                print(f"Alat '{nama}' berhasil ditambahkan.")

            # READ
            elif pilihan == "2":
                os.system("cls" if os.name == "nt" else "clear")
                print("=== DATA ALAT BERAT ===")
                table = PrettyTable()
                table.field_names = ["Nama", "Merek", "Tahun", "Status"]
                for nama, data in alat_berat.items():
                    table.add_row([nama, data["merek"], data["tahun"], data["status"]])
                print(table)

            # UPDATE
            elif pilihan == "3":
                os.system("cls" if os.name == "nt" else "clear")
                print("=== UBAH STATUS ALAT ===")
                for nama, data in alat_berat.items():
                    print(f"- {nama} ({data['status']})")
                alat = input("Masukkan nama alat yang ingin diubah: ").strip()
                if alat in alat_berat:
                    status_baru = input("Masukkan status baru: ").strip()
                    alat_berat[alat]["status"] = status_baru
                    print(f"Status alat '{alat}' berhasil diubah menjadi {status_baru}")
                else:
                    print("Nama alat tidak ditemukan!")

            # DELETE
            elif pilihan == "4":
                os.system("cls" if os.name == "nt" else "clear")
                print("=== HAPUS ALAT BERAT ===")
                for nama in alat_berat:
                    print(f"- {nama}")
                alat = input("Masukkan nama alat yang ingin dihapus: ").strip()
                if alat in alat_berat:
                    alasan = input("Kenapa ingin menghapus alat ini (Rusak/Ingin Diperbaiki): ").strip()
                    del alat_berat[alat]
                    print(f"Alat '{alat}' berhasil dihapus karena {alasan}.")
                else:
                    print("Nama alat tidak ditemukan!")

            elif pilihan == "5":
                break
            else:
                print("Gunakan nomor menu yang benar!")

    # REGISTER (user)
    elif menu == "2":
        print("=== REGISTER ===")
        username = input("Masukkan username baru: ").strip()
        password = input("Masukkan password baru: ").strip()

        if username in pengguna:
            print("Username sudah terdaftar!")
        else:
            pengguna[username] = {"password": password, "akses": "user"}
            print("Akun berhasil dibuat!")

            akses = "user"
            while akses == "user":
                print("\n=== MENU USER ===")
                print("1. Lihat alat berat")
                print("2. Keluar")
                pilihan = input("Pilih menu (1-2): ")
                if pilihan == "1":
                    os.system("cls" if os.name == "nt" else "clear")
                    table = PrettyTable()
                    table.field_names = ["Nama", "Merek", "Tahun", "Status"]
                    for nama, data in alat_berat.items():
                        table.add_row([nama, data["merek"], data["tahun"], data["status"]])
                    print(table)
                elif pilihan == "2":
                    break
                else:
                    print("Gunakan nomor menu yang benar!")

    elif menu == "3":
        print("Program berhenti.")
        break

    else:
        print("Pilihan menu tidak sesuai!")
